#!/bin/sh
script_dir=`dirname $0`
# Sets proper CARM*
eval `${script_dir}/print_sys_def.py -s`

script_name=`basename $0`
_full_path_script_dir=`cd $script_dir;pwd`
dir_name=`basename $_full_path_script_dir`

SOURCE_FILE=$CARMUSR/crc/source/default
TARGET_FILE=${SOURCE_FILE}_calibration_lookback

echo "/* -*- crc -*- */" > $TARGET_FILE
echo "/*" >> $TARGET_FILE
echo " * This file has been generated by '$dir_name/$script_name'." >> $TARGET_FILE
echo " * Do not change in this file. Change the script." >> $TARGET_FILE
echo " *" >> $TARGET_FILE
echo " * **********************************************/" >> $TARGET_FILE

replace_module()
{
    module=$1
    new_module=$2
    sed s/"\([[:space:]]\)${module};"/"\1${new_module};"/g
}

tail -n +1 $SOURCE_FILE \
  | replace_module trip_rules_exp_gantt trip_rules_exp_gantt_calibration_lookback \
  | replace_module easa_ftl_jcp easa_ftl_jcp_calibration_lookback \
  | replace_module calibration_history_impl calibration_history_impl_lookback \
  | replace_module far far_calibration_lookback \
  | replace_module studio_calibration studio_calibration_lookback \
  | replace_module report_calibration report_calibration_move \
  >> $TARGET_FILE
echo >> $TARGET_FILE
echo 'require "studio_mappings_calibration_lookback"' >> $TARGET_FILE
echo 'require "studio_mappings_calibration_timetable"' >> $TARGET_FILE
echo "#if Product(Studio)" >> $TARGET_FILE
echo "    use calibration_lookback;" >> $TARGET_FILE
echo "    use calibration_lookback_mappings;" >> $TARGET_FILE
echo "    use calibration_move_history_studio;" >> $TARGET_FILE
echo "    use calibration_move_mappings;" >> $TARGET_FILE
echo "    use calibration_operational_codes;" >> $TARGET_FILE
echo "    use studio_calibration_timetable;" >> $TARGET_FILE
echo "end"  >> $TARGET_FILE

echo $TARGET_FILE has been created.
