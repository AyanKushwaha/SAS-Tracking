
import uuid
import xmlrpclib
import xml.etree.ElementTree as ET
from xml.dom import minidom
import StringIO
import random
import time    
import sys
import threading
import datetime

crews = ["10033","10034","10078","10088","10098","10103","10104","10112","10125","10137","10142","10147","10150","10169","10174","10176","10185","10187","10201","10206","10213","10214","10215","10219","10223","10227","10228","10234","10237","10239","10240","10241","10242","10246","10251","10253","10255","10258","10262","10265","10266","10270","10279","10283","10286","10290","10291","10292","10293","10294","10298","10300","10301","10302","10303","10306","10307","10314","10315","10316","10319","10321","10346","10350","10353","10360","10365","10373","10376","10382","10388","10397","10398","10400","10401","10405","10431","10434","10435","10438","10440","10444","10446","10449","10450","10457","10459","10473","10476","10477","10478","10481","10485","10488","10489","10490","10491","10492","10494","10495","10498","10499","10503","10514","10518","10522","10526","10533","10534","10535","10536","10541","10551","10565","10566","10567","10569","10571","10572","10573","10574","10575","10577","10579","10580","10582","10585","10586","10587","10594","10595","10597","10604","10607","10616","10618","10623","10634","10637","10639","10642","10646","10647","10653","10665","10667","10668","10675","10679","10681","10683","10689","10691","10709","10710","10712","10713","10714","10715","10720","10721","10750","10751","10756","10759","10762","10765","10781","10782","10786","10787","10789","10793","10802","10803","10813","10818","10819","10820","10825","10833","10849","10850","10852","10855","10857","10860","10863","10867","10868","10873","10877","10884","10888","10889","10894","10901","10916","10922","10926","10928","10933","10934","10938","10944","10945","10949","10955","10958","10959","10960","10961","10962","10965","10968","10969","10974","10976","10978","10983","10984","10985","10987","10991","10993","10996","10997","10999","11014","11017","11018","11023","11024","11026","11029","11031","11034","11037","11038","11049","11055","11065","11068","11071","11089","11096","11099","11101","11102","11116","11134","11143","11145","11148","11153","11163","11170","11171","11172","11174","11175","11184","11185","11187","11188","11191","11192","11200","11207","11213","11216","11220","11233","11238","11241","11250","11259","11267","11270","11272","11274","11282","11285","11286","11292","11294","11299","11307","11314","11316","11319","11326","11332","11346","11378","11380","11382","11397","11408","11417","11422","11431","11440","11451","11459","11468","11472","11483","11492","11494","11498","11513","11518","11525","11526","11528","11531","11543","11544","11559","11561","11563","11564","11574","11580","11598","11602","11603","11606","11613","11615","11628","11640","11641","11642","11654","11682","11686","11695","11698","11703","11706","11707","11714","11718","11741","11744","11745","11746","11749","11750","11752","11755","11756","11757","11758","11775","11776","11784","11785","11794","11799","11833","11838","11849","11864","11867","11872","11873","11874","11879","11880","11893","11906","11936","11938","11958","11960","11973","11980","12060","12078","12176","12184","12204","12219","12221","12237","12272","12279","12347","12355","12357","12391","12412","12482","12485","12518","12521","12554","12566","12592","12604","12605","12609","12632","12657","12676","12683","12710","12741","12754","12760","12766","12808","12829","12835","12881","12893","12937","12938","12958","12984","13022","13038","13044","13050","13085","13089","13130","13138","13152","13153","13162","13179","13187","13194","13198","13202","13235","13260","13267","13316","13320","13328","13332","13343","13364","13370","13378","13385","13407","13415","13421","13425","13451","13486","13493","13544","13589","13636","13649","13671","13700","13704","13732","13751","13772","13776","13785","13808","13810","13825","13858","13863","13879","13915","13921","13922","13954","13965","13971","13983","13999","14004","14017","14023","14030","14047","14048","14050","14054","14073","14097","14117","14125","14151","14171","14183","14186","14196","14200","14211","14240","14243","14284","14311","14336","14338","14339","14376","14409","14413","14414","14418","14433","14444","14446","14452","14457","14458","14461","14481","14483","14490","14507","14511","14521","14547","14549","14573","14576","14583","14616","14618","14631","14632","14635","14641","14642","14645","14654","14663","14671","14676","14703","14707","14718","14724","14733","14754","14777","14793","14794","14799","14803","14813","14838","14839","14845","14846","14873","14878","14888","14909","14931","14943","14946","14958","14961","14966","15000","15019","15031","15035","15040","15048","15049","15051","15067","15072","15082","15087","15094","15098","15140","15151","15157","15173","15202","15204","15226","15230","15236","15246","15270","15271","15274","15275","15278","15281","15286","15291","15295","15302","15306","15314","15320","15375","15378","15381","15396","15402","15413","15416","15418","15419","15440","15445","15447","15451","15454","15458","15459","15462","15472","15474","15477","15479","15483","15502","15517","15521","15527","15536","15542","15544","15553","15579","15580","15595","15601","15616","15646","15649","15662","15674","15698","15703","15704","15721","15743","15746","15752","15755","15795","15796","15797","15800","15801","15803","15804","15805","15806","15825","15840","15843","15850","15855","15857","15878","15881","15905","15908","15920","15939","15946","15959","15961","15990","15991","15992","16000","16006","16016","16029","16053","16055","16068","16074","16078","16080","16083","16086","16087","16091","16094","16098","16104","16105","16106","16108","16116","16144","16148","16151","16163","16167","16168","16170","16171","16173","16174","16177","16178","16180","16181","16182","16183","16184","16186","16187","16202","16225","16230","16241","16244","16245","16251","16252","16254","16255","16264","16265","16268","16271","16274","16276","16279","16289","16312","16321","16338","16339","16347","16350","16358","16384","16394","16409","16432","16453","16454","16458","16480","16501","16515","16527","16529","16560","16566","16580","16598","16607","16621","16624","16627","16645","16674","16685","16714","16722","16725","16738","16741","16760","16792","16813","16822","16857","16888","16897","16905","16970","16976","16997","17007","17037","17039","17043","17052","17058","17059","17062","17063","17066","17067","17070","17071","17072","17077","17087","17091","17094","17095","17096","17100","17101","17123","17141","17142","17156","17161","17190","17201","17217","17232","17233","17234","17238","17241","17248","17256","17291","17306","17307","17309","17317","17333","17337","17353","17380","17393","17397","17407","17410","17413","17415","17423","17426","17439","17441","17447","17452","17454","17461","17464","17469","17474","17475","17483","17484","17488","17490","17494","17502","17507","17539","17548","17551","17552","17576","17579","17612","17613","17620","17621","17622","17623","17624","17654","17656","17659","17669","17704","17706","17717","17720","17736","17741","17746","17749","17756","17758","17759","17760","17769","17778","17783","17787","17794","17805","17807","17812","17814","17815","17816","17823","17825","17826","17828","17832","17834","17835","17837","17844","17846","17847","17849","17850","17851","17853","17859","17860","17861","17863","17865","17867","17868","17871","17876","17879","17880","17881","17882","17883","17887","17905","17918","17923","17950","17951","17976","17981","17992","17994","18004","18009","18013","18032","18038","18039","18042","18048","18067","18068","18106","18110","18111","18112","18124","18125","18128","18130","18139","18159","18161","18164","18167","18170","18172","18196","18198","18201","18202","18218","18235","18238","18239","18241","18243","18244","18260","18267","18275","18278","18285","18286","18299","18300","18302","18306","18307","18308","18309","18312","18331","18342","18366","18372","18385","18386","18403","18434","18440","18449","18477","18489","18501","18502","18512","18517","18519","18524","18531","18533","18554","18559","18560","18567","18583","18584","18586","18587","18590","18596","18603","18604","18606","18617","18639","18640","18642","18644","18648","18650","18653","18657","18658","18659","18661","18664","18678","18684","18689","18701","18704","18719","18721","18722","18726","18728","18732","18738","18742","18745","18753","18759","18760","18765","18770","18771","18772","18773","18776","18781","18784","18788","18791","18792","18796","18798","18804","18817","18820","18824","18825","18842","18854","18857","18859","18877","18879","18885","18898","18919","18920","18924","18927","18928","18937","18938","18939","18941","18943","18947","18956","18957","18959","18962","18964","18970","18976","18981","18989","18992","19005","19008","19023","19032","19044","19051","19062","19071","19075","19095","19096","19099","19105","19118","19127","19142","19157","19158","19166","19167","19178","19179","19180","19184","19185","19188","19189","19192","19194","19196","19205","19218","19222","19234","19247","19256","19264","19265","19266","19267","19268","19272","19273","19284","19294","19295","19313","19321","19333","19334","19338","19340","19348","19351","19365","19368","19373","19376","19389","19395","19397","19398","19399","19401","19408","19416","19417","19422","19425","19427","19428","19433","19438","19449","19453","19454","19456","19487","19505","19506","19515","19518","19526","19529","19531","19536","19542","19551","19552","19556","19565","19570","19575","19581","19591","19597","19599","19606","19618","19620","19627","19635","19637","19640","19654","19655","19662","19665","19666","19673","19688","19706","19710","19712","19716","19718","19727","19736","19762","19766","19767","19775","19776","19782","19785","19791","19794","19796","19798","19800","19812","19815","19819","19844","19845","19851","19854","19858","19862","19885","19886","19888","19893","19895","19910","19912","19913","19914","19916","19917","19918","19920","19926","19932","19934","19940","19950","19955","19956","19957","19964","19965","19970","19973","19981","19986","19996","20091","20096","20105","20122","20155","20164","20195","20198","20200","20202","20206","20207","20246","20271","20313","20343","20346","20348","20370","20376","20385","20392","20395","20397","20414","20427","20441","20450","20467","20474","20477","20479","20483","20485","20486","20489","20490","20491","20494","20501","20505","20538","20548","20553","20563","20566","20569","20574","20578","20582","20584","20586","20588","20594","20602","20610","20614","20620","20621","20628","20635","20653","20657","20705","20717","20727","20755","20760","20769","20837","20846","20863","20881","20890","20904","20913","20935","20946","20948","20961","20968","20988","20994","21011","21035","21065","21075","21083","21089","21094","21095","21097","21103","21104","21110","21111","21112","21114","21116","21124","21126","21144","21161","21166","21167","21173","21174","21175","21176","21177","21180","21186","21188","21190","21191","21202","21203","21205","21208","21211","21212","21217","21218","21221","21222","21223","21226","21236","21239","21242","21251","21261","21263","21266","21271","21272","21299","21300","21313","21319","21321","21323","21327","21328","21329","21332","21337","21359","21386","21406","21418","21452","21462","21464","21474","21492","21512","21525","21569","21579","21591","21595","21596","21597","21605","21648","21651","21654","21670","21674","21676","21679","21682","21688","21692","21696","21705","21710","21711","21713","21714","21718","21723","21727","21728","21739","21745","21746","21747","21770","21782","21785","21786","21792","21820","21821","21826","21831","21839","21851","21875","21880","21885","21887","21894","21899","21901","21903","21907","21908","21911","21914","21916","21924","21931","21932","21935","21938","21946","21947","21954","21962","21973","21997","22015","22048","22079","22082","22083","22084","22088","22163","22175","22194","22200","22220","22223","22225","22230","22235","22241","22262","22268","22288","22298","22303","22332","22357","22358","22369","22385","22387","22392","22395","22396","22397","22399","22400","22402","22405","22411","22412","22416","22420","22423","22428","22430","22446","22456","22458","22464","22468","22470","22471","22475","22481","22489","22491","22497","22507","22512","22513","22515","22524","22525","22527","22531","22532","22535","22536","22541","22560","22564","22576","22578","22580","22584","22590","22592","22593","22656","22678","22701","22710","22722","22728","22740","22756","22760","22761","22765","22768","22777","22779","22785","22794","22808","22824","22825","22839","22854","22856","22858","22862","22865","22875","22883","22896","22901","22903","22912","22914","22940","22941","22942","22947","22956","22957","22963","22981","22990","22994","22995","22998","23001","23002","23041","23043","23056","23063","23065","23094","23097","23099","23104","23106","23118","23119","23135","23138","23150","23156","23163","23172","23175","23176","23177","23185","23189","23191","23193","23198","23199","23202","23212","23213","23223","23227","23232","23252","23253","23255","23258","23262","23265","23266","23267","23268","23270","23276","23286","23289","23300","23301","23331","23336","23339","23348","23349","23357","23359","23361","23363","23364","23365","23373","23374","23395","23397","23405","23409","23431","23438","23441","23456","23458","23460","23461","23463","23464","23465","23467","23473","23475","23478","23483","23484","23486","23491","23492","23505","23506","23507","23512","23514","23515","23537","23548","23565","23581","23587","23615","23619","23621","23622","23624","23626","23627","23647","23650","23653","23654","23656","23657","23658","23663","23664","23667","23669","23673","23676","23684","23685","23687","23690","23691","23692","23698","23703","23704","23713","23715","23718","23723","23736","23737","23742","23743","23748","23756","23759","23765","23767","23771","23774","23778","23787","23792","23816","23823","23825","23833","23842","23844","23848","23849","23852","23859","23860","23863","23869","23872","23876","23877","23881","23891","23907","23908","23914","23920","23922","23923","23931","23932","23933","23934","23938","23940","23953","23962","23972","23978","23982","23985","23990","23998","24001","24002","24010","24030","24034","24040","24047","24072","24078","24080","24083","24085","24087","24088","24094","24097","24113","24115","24116","24120","24125","24129","24135","24142","24144","24145","24148","24159","24160","24162","24163","24165","24169","24171","24173","24179","24180","24187","24188","24194","24206","24208","24211","24215","24216","24217","24218","24232","24236","24254","24256","24268","24271","24272","24286","24289","24290","24308","24332","24373","24376","24395","24398","24417","24429","24431","24438","24440","24451","24457","24464","24494","24505","24506","24515","24520","24529","24547","24551","24571","24590","24601","24602","24607","24608","24618","24624","24629","24635","24638","24642","24648","24656","24694","24695","24723","24731","24762","24771","24786","24791","24802","24813","24822","24826","24830","24835","24836","24837","24845","24846","24853","24854","24865","24869","24873","24876","24891","24893","24900","24910","24913","24915","24916","24920","24931","24933","24935","24937","24950","24951","24956","24958","24966","24971","24973","24978","24982","24983","24985","24987","24990","24999","25000","25003","25004","25008","25009","25015","25037","25039","25053","25060","25063","25065","25071","25082","25086","25099","25105","25110","25112","25114","25115","25116","25118","25125","25133","25137","25142","25144","25149","25156","25168","25185","25189","25191","25193","25195","25202","25205","25206","25213","25217","25225","25246","25250","25262","25276","25303","25328","25331","25335","25337","25343","25351","25389","25414","25416","25418","25425","25436","25458","25462","25463","25481","25500","25502","25510","25511","25519","25520","25531","25533","25545","25548","25558","25561","25562","25566","25575","25581","25584","25588","25589","25591","25595","25596","25598","25600","25601","25610","25612","25613","25619","25620","25622","25628","25635","25636","25637","25640","25642","25643","25644","25646","25648","25650","25651","25652","25654","25655","25657","25660","25661","25666","25675","25678","25683","25684","25686","25688","25694","25703","25704","25705","25711","25718","25721","25723","25724","25726","25727","25728","25729","25730","25731","25732","25733","25737","25738","25739","25741","25742","25745","25746","25749","25750","25752","25757","25759","25764","25774","25777","25779","25781","25782","25786","25791","25793","25795","25798","25799","25800","25801","25816","25821","25830","25831","25836","25852","25859","25867","25873","25875","25891","25893","25894","25900","25901","25909","25912","25914","25916","25926","25934","25938","25944","25947","25949","25951","25953","25954","25958","25967","25976","25979","25983","26002","26011","26015","26018","26024","26031","26035","26042","26045","26054","26056","26074","26075","26077","26081","26082","26094","26103","26112","26160","26164","26194","26196","26203","26204","26209","26211","26223","26240","26247","26263","26264","26274","26277","26279","26280","26284","26288","26293","26296","26298","26299","26301","26302","26308","26313","26326","26335","26338","26340","26344","26345","26346","26349","26352","26354","26356","26367","26370","26372","26379","26380","26381","26386","26387","26388","26399","26401","26405","26411","26416","26419","26421","26424","26428","26429","26431","26432","26434","26436","26438","26439","26443","26446","26451","26455","26457","26460","26464","26469","26472","26475","26480","26482","26483","26484","26487","26488","26493","26495","26496","26497","26500","26507","26511","26517","26529","26531","26549","26568","26574","26591","26603","26614","26619","26625","26628","26629","26631","26633","26637","26638","26639","26641","26646","26651","26657","26658","26661","26662","26663","26664","26668","26673","26674","26676","26682","26689","26695","26702","26703","26708","26710","26712","26715","26717","26718","26720","26724","26725","26739","26742","26744","26754","26759","26760","26769","26772","26774","26775","26779","26783","26792","26797","26800","26802","26813","26815","26816","26817","26820","26835","26836","26837","26839","26845","26849","26856","26857","26859","26862","26863","26868","26873","26887","26890","26897","26898","26901","26902","26905","26906","26908","26910","26912","26925","26929","26939","26944","26945","26948","26949","26950","26952","26976","26978","26997","26998","27000","27002","27028","27034","27043","27044","27045","27051","27059","27063","27069","27070","27071","27075","27078","27085","27099","27100","27102","27104","27117","27121","27122","27124","27125","27130","27133","27137","27144","27149","27150","27152","27158","27161","27166","27167","27175","27177","27183","27185","27197","27198","27205","27208","27216","27221","27227","27228","27233","27235","27241","27242","27246","27247","27249","27250","27260","27261","27262","27263","27264","27268","27271","27274","27276","27281","27282","27283","27287","27289","27309","27317","27321","27325","27326","27333","27334","27349","27375","27490","27527","27541","27542","27555","27572","27576","27587","27629","27630","27636","27641","27644","27646","27648","27649","27653","27667","27668","27669","27670","27671","27672","27674","27676","27677","27680","27681","27682","27683","27685","27690","27691","27692","27693","27695","27701","27704","27706","27709","27710","27712","27713","27715","27733","27734","27735","27737","27738","27742","27744","27747","27752","27754","27755","27757","27758","27763","27767","27775","27786","27790","27798","27799","27802","27804","27805","27806","27833","27835","27840","27844","27845","27854","27864","27870","27875","27878","27880","27882","27886","27888","27889","27898","27900","27901","27923","27925","27927","27934","27937","27945","27948","27952","27955","27958","27963","27989","28000","28002","28004","28006","28007","28008","28009","28010","28011","28012","28013","28014","28016","28017","28018","28020","28021","28023","28024","28026","28028","28035","28041","28044","28052","28055","28056","28061","28067","28077","28078","28079","28081","28084","28085","28100","28106","28107","28108","28109","28110","28114","28123","28125","28136","28140","28146","28147","28148","28162","28165","28168","28175","28178","28180","28181","28186","28187","28190","28194","28195","28209","28220","28221","28242","28243","28245","28248","28249","28250","28251","28252","28255","28260","28262","28305","28306","28319","28322","28323","28326","28331","28332","28335","28338","28357","28399","28400","28401","28406","28407","28413","28414","28415","28441","28463","28558","28567","28568","28571","28583","28618","28619","28632","28633","28634","28638","28641","28655","28673","28677","28698","28709","28712","28713","28714","28717","28733","28745","28750","28760","28766","28767","28768","28769","28770","28771","28774","28776","28779","28780","28781","28782","28787","28791","28794","28795","28798","28800","28808","28809","28827","28834","28836","28838","28840","28844","28845","28850","28853","28859","28860","28861","28862","28863","28864","28882","28991","29042","29044","29057","29076","29090","29116","29119","29126","29127","29135","29137","29140","29148","29154","29163","29176","29178","29180","29183","29184","29191","29193","29195","29197","29200","29201","29203","29208","29220","29226","29227","29228","29230","29231","29232","29233","29234","29243","29246","29249","29253","29266","29281","29285","29291","29292","29294","29295","29298","29302","29307","29319","29324","29341","29349","29350","29359","29362","29365","29371","29373","29375","29415","29427","29428","29429","29433","29434","29438","29440","29441","29449","29450","29454","29455","29456","29459","29461","29462","29467","29469","29485","29507","29508","29512","29524","29525","29530","29534","29537","29545","29546","29547","29549","29550","29553","29554","29563","29564","29565","29568","29571","29572","29592","29595","29596","29601","29603","29611","29625","29644","29670","29799","29805","29806","29928","29934","29967","29968","29969","29972","29973","29974","29975","29976","29977","29979","29982","29992","29993","29994","29995","29997","31066","31119","31256","31290","31454","31459","31498","31500","31501","31535","31556","31579","31580","31593","31611","31612","31614","31616","31618","31619","31621","31622","31623","31624","31625","31626","31628","31629","31630","31631","31633","31637","31697","31721","31724","31772","31780","31781","31782","31783","31784","31785","31786","31788","31791","31793","31794","31920","31921","31922","31923","31924","31925","31926","31927","31929","31930","31931","31932","32000","32157","32158","32160","32161","32163","32164","32165","32166","32168","32170","32171","32172","32174","32176","32177","32178","32180","32182","32183","32184","32186","32187","32189","32190","32191","32192","32193","32195","32197","32198","32200","32201","32203","32204","32207","32208","32212","32214","32215","32216","32218","32219","32220","32221","32228","32232","32233","32236","32238","32239","32240","32241","32244","32245","32246","32669","32704","32756","32853","32857","32858","32859","32861","32862","32864","32867","32868","32869","32870","32871","32900","32902","32903","32904","32905","32906","32910","32911","32914","32915","33060","33268","33347","33348","33350","33352","33353","33355","33358","33361","33362","33367","33369","33371","33403","33404","33410","33412","33413","33439","33441","33476","33477","33478","33479","33492","33515","33516","33517","33548","33549","33550","33552","33553","33554","33556","33557","33558","33559","33584","33604","33616","33671","33686","33884","33886","33910","33913","33928","33929","33930","33933","33935","33936","33937","33938","33959","34077","34078","34080","34081","34084","34106","34175","34216","34219","34220","34222","34225","34230","34231","34236","34240","34251","34267","34296","34299","34305","34306","34308","34336","34340","34348","34353","34355","34357","34369","34371","34372","34374","34376","34378","34384","34387","34396","34398","34400","34404","34407","34413","34417","34429","34431","34433","34440","34441","34442","34445","34449","34450","34451","34459","34461","34462","34464","34469","34470","34472","34473","34474","34475","34477","34478","34480","34483","34486","34495","34497","34498","34500","34504","34506","34509","34510","34511","34513","34522","34523","34525","34529","34534","34538","34542","34545","34546","34548","34553","34555","34557","34570","34575","34580","34583","34586","34587","34594","34595","34596","34597","34599","34604","34614","34620","34629","34630","34632","34634","34636","34638","34643","34648","34649","34650","34662","34665","34668","34672","34677","34679","34681","34683","34690","34692","34697","34700","34703","34705","34707","34708","34709","34712","34714","34715","34718","34720","34726","34736","34738","34746","34748","34753","34754","34757","34764","34771","34779","34780","34785","34788","34791","34794","34796","34797","34800","34803","34814","34819","34820","34823","34825","34831","34838","34839","34845","34846","34847","34855","34856","34857","34858","34862","34871","34878","34880","34884","34885","34889","34890","34891","34899","34900","34907","34909","34910","34913","34914","34916","34919","34920","34923","34932","34934","34937","34938","34941","34943","34945","34948","34949","34955","34957","34961","34965","34967","34972","34980","34982","34983","34984","34986","34987","34995","35001","35003","35006","35009","35011","35012","35013","35016","35017","35019","35021","35024","35025","35029","35030","35031","35038","35040","35043","35044","35046","35047","35053","35058","35062","35068","35070","35071","35074","35076","35080","35082","35084","35092","35093","35097","35100","35101","35105","35106","35107","35108","35115","35119","35122","35126","35130","35135","35139","35146","35150","35161","35174","35175","35182","35187","35190","35193","35197","35205","35206","35207","35211","35217","35218","35226","35228","35232","35233","35234","35236","35246","35252","35257","35259","35270","35277","35282","35283","35288","35289","35298","35301","35303","35307","35313","35320","35321","35325","35327","35333","35339","35347","35348","35354","35366","35370","35371","35377","35379","35384","35385","35390","35391","35392","35400","35406","35408","35411","35413","35431","35434","35436","35441","35444","35445","35446","35450","35452","35454","35459","35461","35464","35467","35470","35474","35475","35476","35477","35480","35484","35493","35498","35499","35501","35505","35508","35509","35510","35511","35513","35518","35519","35525","35526","35530","35531","35533","35536","35537","35545","35550","35554","35558","35561","35564","35572","35573","35579","35580","35588","35589","35590","35591","35592","35596","35598","35604","35606","35608","35615","35619","35624","35627","35633","35637","35638","35639","35641","35643","35658","35665","35666","35668","35671","35675","35676","35687","35688","35696","35699","35712","35713","35715","35719","35722","35725","35730","35732","35742","35764","35765","35768","35776","35777","35779","35789","35791","35797","35803","35811","35815","35817","35834","35837","35839","35848","35850","35852","35856","35857","35858","35859","35866","35868","35869","35871","35873","35878","35882","35883","35884","35885","35886","35887","35888","35900","35903","35906","35909","35910","35912","35917","35918","35921","35927","35931","35941","35944","35947","35952","35955","36038","36045","36047","36055","36058","36060","36061","36064","36068","36070","36071","36072","36076","36077","36084","36093","36100","36111","36112","36115","36151","36159","36289","36408","36445","36454","36468","36643","36739","36864","36867","36870","37000","37007","37013","37014","37015","37017","37023","37029","37032","37035","37038","37044","37045","37046","37047","37048","37050","37056","37058","37062","37065","37066","37067","37068","37069","37070","37075","37079","37081","37083","37085","37086","37087","37088","37089","37091","37096","37103","37113","37114","37117","37120","37121","37122","37127","37128","37132","37136","37139","37141","37143","37146","37150","37152","37155","37156","37162","37163","37168","37169","37178","37179","37186","37187","37188","37189","37190","37195","37196","37197","37198","37200","37206","37207","37212","37213","37214","37215","37217","37235","37236","37238","37241","37242","37250","37251","37252","37253","37268","37269","37272","37274","37278","37280","37282","37283","37284","37286","37289","37291","37294","37295","37296","37298","37299","37300","37301","37302","37304","37307","37308","37310","37311","37312","37313","37315","37319","37320","37322","37327","37328","37330","37331","37332","37333","37335","37339","37342","37343","37344","37346","37347","37348","37350","37352","37354","37355","37356","37358","37360","37362","37364","37368","37374","37378","37380","37382","37391","37394","37405","37406","37408","37411","37416","37419","37421","37423","37425","37426","37432","37434","37436","37439","37444","37450","37451","37455","37458","37460","37463","37466","37469","37470","37471","37472","37477","37479","37480","37482","37483","37485","37486","37487","37489","37490","37491","37492","37494","37496","37501","37502","37507","37508","37511","37512","37513","37517","37519","37522","37524","37525","37526","37528","37529","37535","37538","37539","37541","37543","37545","37546","37548","37550","37551","37552","37555","37563","37568","37569","37573","37575","37578","37582","37583","37586","37587","37590","37592","37597","37604","37608","37612","37616","37619","37620","37621","37622","37623","37625","37626","37627","37630","37636","37640","37641","37642","37643","37645","37649","37651","37659","37664","37666","37693","37694","37695","37696","37701","37704","37710","37733","37739","37740","37742","37750","37755","37769","37770","37784","37788","37805","37806","37807","37808","37812","37815","37818","37819","37820","37827","37832","37833","37835","37836","37837","37844","37845","37846","37847","37853","37856","37857","37861","37862","37863","37864","37866","37870","37872","37875","37888","37896","37904","37906","37907","37909","37914","37928","37929","37933","37942","37945","37954","37960","37964","37966","37971","37972","37991","37992","37994","37997","38003","38004","38005","38007","38010","38011","38015","38016","38018","38019","38022","38024","38025","38028","38033","38039","38040","38041","38043","38045","38046","38049","38052","38068","38070","38072","38077","38078","38079","38080","38113","38133","38134","38135","38138","38139","38140","38141","38147","38153","38167","38168","38169","38172","38174","38175","38177","38181","38183","38185","38187","38189","38191","38194","38195","38196","38197","38199","38200","38201","38204","38210","38212","38215","38216","38219","38220","38221","38223","38225","38226","38229","38230","38234","38236","38237","38245","38250","38263","38264","38266","38267","38286","38291","38292","38301","38305","38313","38323","38328","38331","38334","38336","38337","38341","38344","38351","38352","38362","38363","38364","38366","38367","38369","38379","38381","38382","38404","38405","38406","38409","38410","38411","38412","38415","38416","38418","38421","38423","38424","38425","38434","38439","38440","38447","38451","38452","38460","38463","38464","38465","38468","38469","38470","38471","38472","38474","38476","38481","38482","38483","38484","38485","38486","38487","38488","38490","38493","38494","38496","38497","38498","38499","38500","38501","38504","38509","38524","38532","38535","38538","38540","38541","38543","38546","38547","38552","38553","38557","38558","38560","38561","38562","38564","38565","38567","38568","38571","38572","38573","38576","38580","38582","38584","38588","38591","38593","38595","38596","38598","38602","38605","38607","38609","38611","38613","38614","38615","38616","38618","38622","38623","38624","38627","38628","38629","38630","38633","38634","38635","38637","38639","38643","38648","38649","38651","38652","38656","38660","38662","38663","38664","38665","38666","38669","38671","38673","38674","38678","38679","38680","38682","38684","38687","38688","38689","38691","38694","38696","38697","38698","38699","38701","38705","38709","38712","38715","38716","38717","38718","38720","38724","38727","38729","38730","38732","38733","38734","38738","38739","38740","38741","38743","38744","38746","38747","38748","38754","38755","38756","38758","38762","38763","38764","38767","38768","38772","38774","38791","38792","38798","38799","38805","38806","38811","38812","38813","38820","38821","38828","38833","38835","38849","38859","38864","38865","38866","38867","38871","38872","38873","38874","38875","38879","38882","38883","38884","38886","38893","38895","38901","38903","38904","38905","38907","38909","38910","38912","38914","38917","38918","38921","38923","38926","38929","38930","38934","38937","38938","38939","38954","38956","38958","38960","38973","38975","38978","38979","38982","38986","38988","38990","38992","38996","38997","39000","39001","39003","39005","39010","39013","39014","39015","39027","39031","39037","39047","39048","39052","39053","39055","39056","39058","39063","39065","39067","39078","39097","39098","39102","39103","39104","39108","39118","39119","39123","39125","39126","39129","39131","39137","39138","39143","39144","39150","39151","39165","39213","39218","39225","39233","39237","39248","39249","39250","39255","39260","39261","39262","39264","39266","39268","39271","39273","39278","39280","39285","39298","39307","39309","39311","39313","39320","39322","39323","39342","39344","39347","39351","39354","39355","39356","39357","39358","39359","39361","39362","39364","39367","39372","39373","39374","39378","39381","39384","39385","39386","39388","39389","39390","39391","39393","39394","39395","39398","39399","39400","39401","39402","39427","39428","39429","39433","39442","39447","39449","39452","39464","39465","39466","39467","39477","39478","39479","39487","39489","39490","39491","39492","39493","39502","39514","39515","39516","39520","39530","39550","39554","39558","39560","39563","39564","39572","39574","39579","39582","39589","39590","39591","39594","39595","39596","39597","39598","39600","39601","39602","39611","39616","39618","39620","39626","39627","39628","39633","39639","39640","39642","39643","39648","39651","39657","39659","39661","39663","39666","39668","39669","39670","39671","39673","39679","39682","39684","39688","39689","39693","39694","39696","39700","39701","39702","39705","39707","39709","39712","39713","39714","39715","39716","39718","39719","39721","39725","39732","39737","39746","39749","39752","39755","39759","39762","39779","39780","39800","39802","39804","39805","39807","39820","39824","39825","39826","39827","39828","39833","39834","39837","39839","39840","39841","39846","39847","39851","39861","39864","39867","39870","39876","39877","39882","39883","39886","39889","39890","39893","39903","39906","39907","39909","39910","39911","39912","39913","39915","39924","39928","39940","39943","39944","39947","39950","39951","39952","39963","39964","39965","39976","39977","39990","39991","39992","39993","39995","39998","39999","40162","41338","41527","41531","41533","41550","41555","41557","41559","41560","41572","41575","41583","41608","41611","41643","41649","41655","41679","42132","42135","42146","42153","42161","42166","42169","42172","42173","42177","42192","42199","42209","42228","42233","42241","42243","42245","42275","42813","42846","42875","42876","42886","42908","42918","42919","42935","42940","42973","42980","42984","42993","42999","43795","44131","44135","44137","44247","44423","44551","44745","44764","44876","46246","46334","46453","46463","46470","46508","46696","46928","46940","47113","47126","47133","47391","47581","47840","47858","48327","48330","48331","48372","48374","48443","48446","48858","49079","49084","49116","49121","49122","49126","49128","49134","49144","49155","49160","49178","49259","49390","49752","49853","49898","49956","49978","49987","49999","50260","55067","56781","60207","62164","62179","62200","62225","62265","62290","62334","62338","62341","62346","62375","62411","62420","62450","62451","62660","62679","62712","62717","62718","62726","62727","62734","62802","62863","62883","62907","62920","62930","62969","62973","63002","63075","63096","63241","63256","63279","63341","63420","63577","63597","63791","63817","63823","63894","63895","63909","63933","63941","63961","63963","63997","64032","64051","64288","64323","64363","64373","64413","64474","64515","64532","64544","64589","64594","64645","64678","64733","64737","64749","64750","64754","64779","64783","64790","64845","64895","64904","64915","64927","64975","64979","65038","65064","65070","65088","65093","65098","65102","65114","65132","65140","65168","65183","65215","65377","65398","65402","65427","65612","65619","65688","65689","65690","65694","65695","65698","65704","65710","65716","65717","65725","65730","65734","65743","65749","65751","65760","65768","65776","65780","65844","65874","65902","65955","65956","66007","66024","66255","66267","66269","66282","66283","66285","66286","66287","66289","66294","66302","66313","66317","66320","66324","66328","66330","66349","66358","66360","66362","66365","66367","66368","66371","66373","66377","66378","66380","66383","66386","66389","66391","66392","66397","66402","66403","66404","66417","66426","66427","66429","66717","66881","66891","66897","66979","66988","67084","67104","67135","67314","67316","67330","67332","67397","67436","67437","67452","67457","67461","67469","67479","67481","67486","67492","67506","67510","67522","67525","67529","67531","67533","67536","67542","67544","67552","67556","67572","67573","67580","67590","67600","67602","67604","67608","67609","67611","67612","67614","67620","67636","67684","67752","67823","67910","67934","67936","67967","68018","68095","68118","68178","68222","68233","68317","68372","68440","68451","68455","68467","68486","68491","68512","68513","68523","68572","68603","68670","68685","68708","68714","68727","68817","68819","68848","68967","68982","69045","69077","69102","69115","69138","69165","69200","69201","69244","69256","69281","69326","69378","69402","69467","69522","69575","69576","69593","69598","69616","69686","69691","69713","69733","69754","69809","69841","69901","69904","69907","69912","69929","69989","69993","84015","84017","84025","84039","84046","84047","84049","84051","84055","84057","84058","84059","84060","84064","84065","84066","84068","84069","84071","84072","84079","84080","84081","84082","84083","84084","84085","84087","84090","84091","84092","84107","84156","84172","84173","84174","84175","84177","84179","84180","84181","85105","85107","85114","85124","85126","85129","85131","85137","85139","85140","85141","85151","85153","85154","85155","85159","85162","85167","85169","85175","85180","85182","85185","85186","85189","85190","85191","85193","85197","85202","85204","85205","85214","85224","85226","85229","85256","85290","85296","85297","85299","85300","85306","85317","85328","85336","85345","85346","85358","85366","85367","85369","85371","85372","85374","85375","85379","85395","85407","85409","85415","85427","85428","85430","85433","85434","85435","85440","85441","85442","85445","85453","85462","85473","85475","85488","85495","85497","85501","85528","85533","85534","85540","85541","85542","85543","85544","85549","85551","85552","85553","85554","85562","85569","85581","85584","85591","85595","85598","85617","85621","85624","85628","85636","85638","85639","85640","85647","85649","85650","85652","85653","85654","85655","85659","85665","85666","85669","85670","85671","85672","85673","85674","85675","85683","85684","85685","85686","85687","85688","85689","85693","85694","85695","85697","85698","85702","85705","85706","85707","85708","85709","85715","85716","85717","85744","85745","85746","85747","85748","85759","85760","85762","85765","85766","85767","85770","85771","85772","85773","85774","85775","85778","85780","85781","85784","85785","85790","85793","85797","85798","85799","85800","85802","85803","85806","85847","85848","85849","85852","85854","85855","85858","85878","85880","85882","85884","85885","85889","85894","85895","85896","86100","86103","86109","86111","86114","86117","86118","86130","86131","86133","86135","86136","86140","86147","86148","86151","86154","86164","86172","86174","86175","86180","86182","86183","86192","86198","86199","86200","86201","86207","86209","86211","86214","86215","86226","86239","86244","86246","86247","86248","86249","86251","86252","86253","86254","86261","86262","86263","86265","86341","86348","86350","86352","86355","86357","86361","86363","86364","86369","86370","86373","86382","86390","86397","86520","86531","86533","86539","86561","86569","86576","86578","86596","86599","86606","86611","86614","86616","86620","86624","86633","86935","86936","86937","86939","86941","86942","86943","86944","86945","87017","87018","87020","87021","87101","87106","87129","87141","87142","87146","87147","87149","87151","87153","87154","87155","87156","87157","87158","87159","87160","87161","87162","87163","87501","87503","87513","87515","87518","87519","87521","87522","87523","87524","87526","87529","87532","87535","87541","87543","87547","87550","87551","87554","87556","87557","87562","87565","87566","87567","87572","87573","87736","87737","87755","87763","87764","87768","87788","87791","87792","87794","87795","87798","87799","87800","87801","87803","87804","87805","87807","87808","87809","87811","87813","87815","87816","87818","87824","87870","87876","87877","87878","87879","87887","87897","87902","87904","87905","87908","87909","87916","87921","87926","87931","87938","87949","87953","87955","87963","87970","87973","87974","87975"]
accounts = ['F7S', 'FS']

roster_request = '''<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<ns7:getRosterParameters biddingCrewId="%(crew)s" authenticatedCrewId="%(crew)s" id="114ac6fa-12b3-4331-a1bc-710619541ede" 
xmlns:ns2="http://carmen.jeppesen.com/crewweb/framework/xmlschema/datasource/configuration" 
xmlns="http://carmen.jeppesen.com/crewweb/framework/xmlschema/import" 
xmlns:ns4="http://carmen.jeppesen.com/crewweb/framework/xmlschema/common" 
xmlns:ns3="http://carmen.jeppesen.com/crewweb/framework/xmlschema/backendcommunication" 
xmlns:ns9="http://carmen.jeppesen.com/crewweb/interbids/xmlschema/requesttype" 
xmlns:ns5="http://carmen.jeppesen.com/crewweb/framework/xmlschema/trip" 
xmlns:ns6="http://carmen.jeppesen.com/crewweb/framework/xmlschema/backendcommunication/getalltrips" 
xmlns:ns10="http://carmen.jeppesen.com/crewweb/framework/xmlschema/bidtype" 
xmlns:ns7="http://carmen.jeppesen.com/crewweb/framework/xmlschema/backendcommunication/getroster" 
xmlns:ns8="http://carmen.jeppesen.com/crewweb/interbids/xmlschema/backendcommunication/request"/>
'''

get_available_daysoff_request='''<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<ns8:availableDaysOffParameters category="A_%(account)s" biddingCrewId="%(crew)s" authenticatedCrewId="%(crew)s" 
id="d3f9134f-43c4-4040-beb1-6f6a9889dd92" 
xmlns:ns2="http://carmen.jeppesen.com/crewweb/framework/xmlschema/datasource/configuration" 
xmlns="http://carmen.jeppesen.com/crewweb/framework/xmlschema/import" 
xmlns:ns4="http://carmen.jeppesen.com/crewweb/framework/xmlschema/common" 
xmlns:ns3="http://carmen.jeppesen.com/crewweb/framework/xmlschema/backendcommunication" 
xmlns:ns9="http://carmen.jeppesen.com/crewweb/interbids/xmlschema/requesttype" 
xmlns:ns5="http://carmen.jeppesen.com/crewweb/framework/xmlschema/trip" 
xmlns:ns6="http://carmen.jeppesen.com/crewweb/framework/xmlschema/backendcommunication/getalltrips" 
xmlns:ns10="http://carmen.jeppesen.com/crewweb/framework/xmlschema/bidtype" 
xmlns:ns7="http://carmen.jeppesen.com/crewweb/framework/xmlschema/backendcommunication/getroster" 
xmlns:ns8="http://carmen.jeppesen.com/crewweb/interbids/xmlschema/backendcommunication/request">
<ns8:interval><ns3:from>%(period_start)s</ns3:from><ns3:to>%(period_end)s</ns3:to>
</ns8:interval></ns8:availableDaysOffParameters>'''


create_request_no_limit = cancel_request = create_request='''<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<ns9:requestParameters type="%(account)s" category="A_%(account)s" biddingCrewId="%(crew)s" authenticatedCrewId="%(crew)s" 
id="cd1fdc7a-8771-4f0a-9868-eef93f38115b" xmlns:ns2="http://carmen.jeppesen.com/crewweb/framework/xmlschema/datasource" 
xmlns="http://carmen.jeppesen.com/crewweb/framework/xmlschema/import" 
xmlns:ns4="http://carmen.jeppesen.com/crewweb/framework/xmlschema/backendcommunication" 
xmlns:ns3="http://carmen.jeppesen.com/crewweb/framework/xmlschema/datasource/configuration" 
xmlns:ns9="http://carmen.jeppesen.com/crewweb/interbids/xmlschema/backendcommunication/request" 
xmlns:ns5="http://carmen.jeppesen.com/crewweb/framework/xmlschema/common" 
xmlns:ns6="http://carmen.jeppesen.com/crewweb/framework/xmlschema/trip" 
xmlns:ns10="http://carmen.jeppesen.com/crewweb/interbids/xmlschema/requesttype" 
xmlns:ns7="http://carmen.jeppesen.com/crewweb/framework/xmlschema/backendcommunication/getalltrips" 
xmlns:ns11="http://carmen.jeppesen.com/crewweb/framework/xmlschema/bidtype" 
xmlns:ns8="http://carmen.jeppesen.com/crewweb/framework/xmlschema/backendcommunication/getroster">
<ns9:period><ns4:from>%(period_start)s</ns4:from><ns4:to>%(period_end)s</ns4:to></ns9:period>
<ns9:attributes><ns5:attribute name="startDate" value="%(date)s"/>
<ns5:attribute name="start" value="%(date)s 00:00"/>
<ns5:attribute name="nr_of_days" value="1"/></ns9:attributes></ns9:requestParameters>'''

period_start = datetime.date.today() + datetime.timedelta(days=45)
period_end = period_start + datetime.timedelta(days=365)

class StressTestThread(threading.Thread):
    def __init__(self, host, write):
        threading.Thread.__init__(self)
        self.id = uuid.uuid4()
        self.rpcfails = []
        self.rpcloopfails = []
        self.rpcexectimes = []
        self.sessiontime = None
        self.awards = 0
        self.s = xmlrpclib.ServerProxy(host)
        self.write = write

    def run(self):
        self.crew = random.choice(crews)
        self.account = random.choice(accounts)
        self.period_start = period_start
        self.period_end = period_end
        if random.random() < 0.25:
            self.date = self.period_end
        else:
            self.date = self.period_start + datetime.timedelta(days=int((self.period_end - self.period_start).days * random.random()))
        print "%s: Starting session with crew=%s, account=%s, date=%s"%(self.id, self.crew, self.account, self.date)

        t1 = time.time()
        self.run_crew_and_account()
        t2 = time.time()
        self.sessiontime = t2 - t1

        print "%s: sessiontime=%.5f"%(self.id, self.sessiontime)
        if self.rpcexectimes:
            print "%s: rpctime.sum=%.5f"%(self.id, sum([y for (x,y) in self.rpcexectimes]))
            print "%s: rpctime.avg=%.5f"%(self.id, sum([y for (x,y) in self.rpcexectimes])/len(self.rpcexectimes))
            for (x,y) in self.rpcexectimes:
                print "%s: rpctime.%s=%.5f"%(self.id, x, y)
        print "%s: rpcfails=%d"%(self.id, len(self.rpcfails))
        print "%s: rpcloopfails=%d"%(self.id, len(self.rpcloopfails))
        print "%s: awards=%d"%(self.id, self.awards)

    def run_crew_and_account(self):
        r = self.call_rpc("get_available_days_off", self.s.get_available_days_off, get_available_daysoff_request%self.__dict__)
        r = self.call_rpc("get_rosters", self.s.get_rosters, roster_request%self.__dict__)

        if self.write:
            time.sleep(max(0, random.normalvariate(10, 3)))
            create_reply = self.call_rpc("create_request", self.s.create_request, create_request%self.__dict__)
            r = self.call_rpc("get_rosters", self.s.get_rosters, roster_request%self.__dict__)

            if create_reply is not None and 'granted' in create_reply.lower():
                self.awards += 1
            else:
                time.sleep(max(0, random.normalvariate(2, 1)))
                r = self.call_rpc("cancel_request", self.s.cancel_request, create_request%self.__dict__)

    def call_rpc(self, name, f, *args):
        """
        Call rpc function during 20s until it doesn't fail (same as Crew Portal)
        """
        t0 = time.time()
        while True:
            try:
                t1 = time.time()
                y = f(*args)
                t2 = time.time()
                self.rpcexectimes.append((name, t2-t1))
                return y
            except:
                self.rpcfails.append(name)
                if (time.time() - t0) > 20:
                    self.rpcloopfails.append(name)
                    return None
                else:
                    time.sleep(0.5)
    
def run_paralell_runs(host, users_per_hour, write):
    sleep_time = 3600.0 / users_per_hour
    print "%d users per hour on host=%s, period_start=%s, period_end=%s, write=%s. Will start one thread every %f second"%(users_per_hour, host, period_start, period_end, write, sleep_time)
    id = 0
    while True:
        id+=1
        StressTestThread(host, write).start()
        time.sleep(sleep_time)

if __name__ == '__main__':
    if len(sys.argv) < 4:
        print "Usage: stress_test_request.py <host> <users per hour> <r/w>"
        sys.exit(1)

    host = sys.argv[1]
    users = int(sys.argv[2])
    if sys.argv[3] == "w":
        write = True
    else:
        write = False
    run_paralell_runs(host, users, write)
 
